<!DOCTYPE html>
<html>
<head>
	<title>Leaflet Quick Start Guide Example</title>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="http://leafletjs.com/dist/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="../dist/leaflet.ie.css" /><![endif]-->
</head>
<body>
	<div id="map" style="width: 800px; height: 600px"></div>

	<script src="http://localhost/api/leaflet/leaflet.js"></script>
	<script>
var getEquidistancePolygon = function(points, d) {		// получить обрамление линии
    var out = [];
    if(points.length) {
        var p = points[0];
        for (var i = 1, len = points.length; i < len; i++) {
            var p1 = points[i];
            var dx = p1.x - p.x;
            var dy = p1.y - p.y;
            var d2 = dx*dx + dy*dy;
            if(d2 > 0) {
                var dp = d / Math.sqrt(d2);
                var x0 = p1.x + dp * dx,		y0 = p1.y + dp * dy;
                var x3 = p1.x - dx - dp * dx,	y3 = p1.y - dy - dp * dy;
                var y01 = y0 - p1.y,	x01 = p1.x - x0;
                var y30 = y3 - p.y,		x30 = p.x - x3;
                out.push([
                    [x0 + y01, y0 + x01]	// поворот на 90 град. точки p1 вокруг точки (x0,y0)
                    ,[x0 - y01, y0 - x01]	// поворот на -90 град. точки p1 вокруг точки (x0,y0)
                    ,[x3 + y30, y3 + x30]	// поворот на 90 град. точки p вокруг точки (x3,y3)
                    ,[x3 - y30, y3 - x30]	// поворот на -90 град. точки p вокруг точки (x3,y3)
                ]);
            }
            p = p1;
        }
    }
    return out;
}
L.GMXLinesFill = L.Polyline.extend({
    _getPathPartStr: function (points) {
        var round = L.Path.VML;
        var pointSize = this.options.pointSize || 5;
        var weight = (this.options.shiftWeight ? this.options.weight || 1 : 0);
        
        var arr = getEquidistancePolygon(points, 1.5*pointSize);
        for (var i = 0, len2 = arr.length, str = '', p; i < len2; i++) {
            p = arr[i];
            str += 'M' + p[0][0] + ' ' + p[0][1] +
                'L' + p[1][0] + ' ' + p[1][1] +
                'L' + p[2][0] + ' ' + p[2][1] +
                'L' + p[3][0] + ' ' + p[3][1] +
                'L' + p[0][0] + ' ' + p[0][1];
        }
        return str;
    }
    ,
    _updatePath: function () {
        if (!this._map) { return; }
        
        this._clipPoints();
        if(!this.options.skipSimplifyPoint) this._simplifyPoints();
        
        L.Path.prototype._updatePath.call(this);
    }
});
		var map = L.map('map').setView([55.18, -179], 3);

		L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
		}).addTo(map);
		//L.marker([55.18, 157.09], {draggable:true}).addTo(map);
		
var style = {color: "#0000ff", fill: true, fillColor: "#0000ff", weight: 0, opacity: 1, fillOpacity: 1, 'pointSize': 3, clickable: true};
var points = [
	[55.18, -169] 
	,[56.18, -179.0625] 
];
var mark1 = new L.GMXLinesFill(points, style);
map.addLayer(mark1);
/*
		var myIcon = L.icon({
			iconUrl: 'http://leafletjs.com/dist/images/marker-icon.png',
			iconAnchor: new L.Point(0, 0)
		});
		
		var latLng = new L.LatLng(55.18, 157.09);
		var myMarker = new L.Marker(latLng, {icon: myIcon, draggable:true});
		map.addLayer(myMarker);
		//map.panTo(latLng);
		
		//L.marker([55.18, 157.09], {icon: myIcon, draggable:true}).addTo(map);
			//.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

		L.circle([51.508, -0.11], 500, {
			color: 'red',
			fillColor: '#f03',
			fillOpacity: 0.5
		}).addTo(map).bindPopup("I am a circle.");

		L.polygon([
			[51.509, -0.08],
			[51.503, -0.06],
			[51.51, -0.047]
		]).addTo(map).bindPopup("I am a polygon.");


		var popup = L.popup();

		function onMapClick(e) {
			popup
				.setLatLng(e.latlng)
				.setContent("You clicked the map at " + e.latlng.toString())
				.openOn(map);
		}

		map.on('click', onMapClick);
*/
	</script>
</body>
</html>
