<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<script src="http://localhost/api/apil.js?key=U92596WMIH" charset="windows-1251"></script>
    <link rel="stylesheet" href="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/styles/jqx.base.css" type="text/css" />
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/scripts/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxdata.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxradiobutton.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxgrid.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/jqwidgets/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="http://www.jqwidgets.com/jquery-widgets-demo/scripts/gettheme.js"></script>
<title>GeoMixer API - примеры использования</title>

</head>

<body>
<div id="map" style="width: 800px; height: 600px; float: left;"></div> <!--задаем контейнер, в который загружается карта -->
<div id="description" style="width: 400px; overflow: auto; padding-left: 20px;">
Показан пример управления HTML контейнером текста всплывающей подсказки
</div>
<br/>
<script>
      createFlashMap(document.getElementById("map"), 'maps.kosmosnimki.ru', "UIRCQ", function(map) //загружает выборочную карту с того хоста, на котором лежит api.js
		{
			map.moveTo(44.340806, 53.225797, 2);//позиционирует карту по координатам центра и выбирает масштаб
			var myLayer = map.layers["0D2CD1ACA4F541D59FBDC8E13956B79C"];
			myLayer.setVisible(true);

			var timer = null;
			var balloonSpan = null;
			var places = '';
			var zone = 0;
			
			var setText = function() {
				if(!balloonSpan) return;
				var sysDate = new Date(new Date().getTime() + zone*60*60*1000);
				var txt = 'Текущее&nbsp;время:&nbsp;<b>';
				txt += gmxAPI.pad2(sysDate.getUTCDate()) + '.';
				txt += gmxAPI.pad2(sysDate.getUTCMonth() + 1) + '.';
				txt += gmxAPI.pad2(sysDate.getUTCFullYear()) + '&nbsp;';
				txt += gmxAPI.pad2(sysDate.getUTCHours()) + ':';
				txt += gmxAPI.pad2(sysDate.getUTCMinutes()) + ':';
				txt += gmxAPI.pad2(sysDate.getUTCSeconds());
				txt += '</b>';
				txt += '<br>places:&nbsp;<b>' + places + '</b>';
				txt += '<br>zone:&nbsp;<b>' + zone + '</b>';
				balloonSpan.innerHTML = txt;
				//console.log(sysDate);
			};
			var jqxgrid = document.getElementById("jqxgrid");
			myLayer.filters[0].clusters.setClustersBalloon(function(o, div) {
				var theme = getDemoTheme();
				var data = [];
				for(var i=0, len = o.members.length; i<len; i++) {	// Подготовка геометрий
					data.push(o.members[i].properties);
				}
				var source =
				{
					localdata: data,
					datafields:
					[
						{ name: 'ogc_fid', type: 'number'},
						{ name: 'Species', type: 'string' },
						{ name: 'Number', type: 'string' },
						{ name: 'Name', type: 'string' },
						{ name: 'Gnezd', type: 'string' },
						{ name: 'Data', type: 'string' },
						{ name: 'Comment', type: 'string' }
					],
					datatype: "array"
				};

				var columns = [
					  { text: 'Id', datafield: 'ogc_fid', width: 50, cellsalign: 'center', align: 'center' },
					  { text: 'Species', datafield: 'Species', width: 200, cellsalign: 'left', align: 'center' },
					  { text: 'Data', datafield: 'Data', width: 80, cellsalign: 'center', align: 'center' },
					  { text: 'Name', datafield: 'Name', width: 120, cellsalign: 'center', align: 'center' },
					  { text: 'Gnezd', datafield: 'Gnezd', width: 80, cellsalign: 'center', align: 'center' },
					  { text: 'Comment', datafield: 'Comment', width: 200, cellsalign: 'left', align: 'center', cellsformat: 'c2' }
					];

				var dataAdapter = new $.jqx.dataAdapter(source);

				// initialize jqxGrid
				
				//$("kosmosnimki_balloon").jqxGrid(
				$("#jqxgrid").jqxGrid(
				{
					width: 670,
					source: dataAdapter,
					theme: theme,
					selectionmode: 'multiplecellsextended',
					columns: columns
				});
				//div.innerHTML = jqxgrid.innerHTML;
				if(jqxgrid) div.appendChild(jqxgrid);
				//jqxgrid = null;
		
		
/*				
				places = o.properties['places'];
				zone = parseInt(o.properties['zone'], 10);
				balloonSpan = gmxAPI.newSpan('');
				if(!timer) timer = setInterval(setText, 1000);
				setText();
				div.appendChild(balloonSpan);
				o.balloon.addListener('onClose', function(ph) {		// при закрытии балуна отменить обновление времени
					if(timer) clearInterval(timer);
					timer = null;
				});
*/				
				return {};	// если тип возвращаемого объекта "object" - это признак того что HTML контейнер текста балуна уже заполнен
				//return 'Ожидание...';	// если тип возвращаемого объекта "string" - это текст балуна
			}, {'disableOnMouseOver': true});
			// включает всплывающие подсказки , отображающие атрибутивную информацию слоев по выбранному атрибутивному значению
		}); 
</script>
        <div id="jqxgrid" style="display:none">
        </div>
</body>
</html>
